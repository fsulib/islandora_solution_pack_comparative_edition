# How Indexing Works

The primary feature of the Islandora Comparative Edition Solution Pack is the ability to compare sentences across several witnesses, and these sentences are collated together into master index files during "the indexing process". This process is triggered every time a new witness is ingested or deleted, as well as any time a *PINDEX datastream on a page object is replaced. To see how indexing works in the code, see the [IslandoraComparativeEditionObject::generateDisplayMindex()](https://github.com/fsulib/islandora_solution_pack_comparative_edition/blob/master/includes/classes.inc#L113) and [IslandoraComparativeEditionObject::generateAnalysisMindex()](https://github.com/fsulib/islandora_solution_pack_comparative_edition/blob/master/includes/classes.inc#L171) functions which kick off the indexing processes for the DISPLAYMINDEX and ANALYSISMINDEX, respectively. 

Once the indexing process has begun, the CE object wrangles all the TEXTPINDEX or HTMLPINDEX datastreams of its page grandchildren (depending on whether the process is for building the DISPLAYMINDEX or ANALYSISMINDEX) and collates them into a big array by sentence ID. If building the DISPLAYMINDEX, the process stops there and the array is encoded into JSON and stored on the CE object. If building the ANALYSISMINDEX, an extra step is taken to send the collated sentences to a CollateX server for syntactical comparison; this is done on a sentence-by-sentence basis until all the sentences have been compared. The results are analysed for variance, and HTML markup is inserted into the sentence strings to show variance (variant sentences will be in a red box, invariant sentences in a green box). Once variance has been determined and marked, the sentencese are encoded into JSON and stored in the CE object's ANALYSISMINDEX datastream.
